<div class="container">
  <header>
    <h1>ğŸ©º Tansiyon Takip</h1>
    <p class="sub">Kan basÄ±ncÄ± Ã¶lÃ§Ã¼mlerinizi takip edin ve saÄŸlÄ±ÄŸÄ±nÄ±zÄ± kontrol altÄ±nda tutun.</p>
  </header>

  <!-- Mesaj Alert -->
  @if (mesaj()) {
  <div class="alert" [class.ok]="mesaj()?.tip === 'ok'" [class.err]="mesaj()?.tip === 'err'">
    {{ mesaj()?.text }}
  </div>
  }

  <section class="ozet-section">
    <h2>ğŸ“Š Tansiyon Ã–zeti</h2>

    <div class="ozet-cards">

      <!-- GÃ¼nlÃ¼k Ã–zet -->
      <div class="ozet-card">
        <div class="ozet-header gunluk">
          <span class="ozet-icon">ğŸ“…</span>
          <span class="ozet-title">BugÃ¼n</span>
        </div>
        @if (gunlukOzet()) {
        <div class="ozet-body">
          <div class="ozet-ortalama">
            <span class="ort-label">Ortalama</span>
            <span class="ort-value">{{ formatOrt(gunlukOzet()?.genelBuyukOrt) }} / {{
              formatOrt(gunlukOzet()?.genelKucukOrt) }}</span>
          </div>
          <div class="ozet-detay">
            <div class="detay-row">
              <span>ğŸŒ… Sabah:</span>
              <span>{{ formatOrt(gunlukOzet()?.sabahBuyukOrt) }} / {{ formatOrt(gunlukOzet()?.sabahKucukOrt) }}</span>
            </div>
            <div class="detay-row">
              <span>ğŸŒ™ AkÅŸam:</span>
              <span>{{ formatOrt(gunlukOzet()?.aksamBuyukOrt) }} / {{ formatOrt(gunlukOzet()?.aksamKucukOrt) }}</span>
            </div>
          </div>
          <div class="ozet-durum" [class]="durumRengi(gunlukOzet()?.durum)">
            <span class="durum-emoji">{{ durumEmoji(gunlukOzet()?.durum) }}</span>
            <span class="durum-text">{{ durumBaslik(gunlukOzet()?.durum) }}</span>
          </div>
          @if (gunlukOzet()?.mesaj) {
          <p class="ozet-mesaj">{{ gunlukOzet()?.mesaj }}</p>
          }
          <p class="ozet-count">{{ gunlukOzet()?.toplamOlcumSayisi }} Ã¶lÃ§Ã¼m</p>
        </div>
        } @else {
        <div class="ozet-body empty">
          <p>BugÃ¼n henÃ¼z Ã¶lÃ§Ã¼m yok</p>
        </div>
        }
      </div>

      <!-- HaftalÄ±k Ã–zet -->
      <div class="ozet-card">
        <div class="ozet-header haftalik">
          <span class="ozet-icon">ğŸ“†</span>
          <span class="ozet-title">Son 7 GÃ¼n</span>
        </div>
        @if (haftalikOzet() && haftalikOzet()?.toplamOlcumSayisi! > 0) {
        <div class="ozet-body">
          <div class="ozet-ortalama">
            <span class="ort-label">Ortalama</span>
            <span class="ort-value">{{ formatOrt(haftalikOzet()?.genelBuyukOrt) }} / {{
              formatOrt(haftalikOzet()?.genelKucukOrt) }}</span>
          </div>
          <div class="ozet-detay">
            <div class="detay-row">
              <span>ğŸŒ… Sabah:</span>
              <span>{{ formatOrt(haftalikOzet()?.sabahBuyukOrt) }} / {{ formatOrt(haftalikOzet()?.sabahKucukOrt)
                }}</span>
            </div>
            <div class="detay-row">
              <span>ğŸŒ™ AkÅŸam:</span>
              <span>{{ formatOrt(haftalikOzet()?.aksamBuyukOrt) }} / {{ formatOrt(haftalikOzet()?.aksamKucukOrt)
                }}</span>
            </div>
          </div>
          <div class="ozet-durum" [class]="durumRengi(haftalikOzet()?.durum)">
            <span class="durum-emoji">{{ durumEmoji(haftalikOzet()?.durum) }}</span>
            <span class="durum-text">{{ durumBaslik(haftalikOzet()?.durum) }}</span>
          </div>
          @if (haftalikOzet()?.mesaj) {
          <p class="ozet-mesaj">{{ haftalikOzet()?.mesaj }}</p>
          }
          <p class="ozet-count">{{ haftalikOzet()?.toplamOlcumSayisi }} Ã¶lÃ§Ã¼m</p>
        </div>
        } @else {
        <div class="ozet-body empty">
          <p>Son 7 gÃ¼nde Ã¶lÃ§Ã¼m yok</p>
        </div>
        }
      </div>

      <!-- 15 GÃ¼nlÃ¼k Ã–zet -->
      <div class="ozet-card">
        <div class="ozet-header onbes-gunluk">
          <span class="ozet-icon">ğŸ—“ï¸</span>
          <span class="ozet-title">Son 15 GÃ¼n</span>
        </div>
        @if (onbesGunlukOzet() && onbesGunlukOzet()?.toplamOlcumSayisi! > 0) {
        <div class="ozet-body">
          <div class="ozet-ortalama">
            <span class="ort-label">Ortalama</span>
            <span class="ort-value">{{ formatOrt(onbesGunlukOzet()?.genelBuyukOrt) }} / {{
              formatOrt(onbesGunlukOzet()?.genelKucukOrt) }}</span>
          </div>
          <div class="ozet-detay">
            <div class="detay-row">
              <span>ğŸŒ… Sabah:</span>
              <span>{{ formatOrt(onbesGunlukOzet()?.sabahBuyukOrt) }} / {{ formatOrt(onbesGunlukOzet()?.sabahKucukOrt)
                }}</span>
            </div>
            <div class="detay-row">
              <span>ğŸŒ™ AkÅŸam:</span>
              <span>{{ formatOrt(onbesGunlukOzet()?.aksamBuyukOrt) }} / {{ formatOrt(onbesGunlukOzet()?.aksamKucukOrt)
                }}</span>
            </div>
          </div>
          <div class="ozet-durum" [class]="durumRengi(onbesGunlukOzet()?.durum)">
            <span class="durum-emoji">{{ durumEmoji(onbesGunlukOzet()?.durum) }}</span>
            <span class="durum-text">{{ durumBaslik(onbesGunlukOzet()?.durum) }}</span>
          </div>
          @if (onbesGunlukOzet()?.mesaj) {
          <p class="ozet-mesaj">{{ onbesGunlukOzet()?.mesaj }}</p>
          }
          <p class="ozet-count">{{ onbesGunlukOzet()?.toplamOlcumSayisi }} Ã¶lÃ§Ã¼m</p>
        </div>
        } @else {
        <div class="ozet-body empty">
          <p>Son 15 gÃ¼nde Ã¶lÃ§Ã¼m yok</p>
        </div>
        }
      </div>

    </div>
  </section>

  
  <section class="card" [class.editing]="duzenlemeModu()">
    <h2>
      @if (duzenlemeModu()) {
      âœï¸ Ã–lÃ§Ã¼m DÃ¼zenle
      } @else {
      â• Yeni Ã–lÃ§Ã¼m Ekle
      }
    </h2>

    @if (duzenlemeModu()) {
    <div class="edit-notice">
      <span>ğŸ“ DÃ¼zenleme modu aktif - ID: {{ duzenlenenId() }}</span>
    </div>
    }

    <div class="grid">
      <label>
        Tarih
        <input type="date" [value]="formTarih()" (input)="formTarih.set($any($event.target).value)" />
      </label>

      <label>
        Zaman Dilimi
        <select [value]="formZaman()" (change)="formZaman.set($any($event.target).value)">
          <option value="SABAH">ğŸŒ… Sabah</option>
          <option value="AKSAM">ğŸŒ™ AkÅŸam</option>
        </select>
      </label>

      <label>
        BÃ¼yÃ¼k Tansiyon (Sistolik)
        <input type="number" placeholder="120" min="50" max="250" [value]="formBuyuk()"
          (input)="formBuyuk.set(+$any($event.target).value || null)" />
      </label>

      <label>
        KÃ¼Ã§Ã¼k Tansiyon (Diyastolik)
        <input type="number" placeholder="80" min="30" max="150" [value]="formKucuk()"
          (input)="formKucuk.set(+$any($event.target).value || null)" />
      </label>
    </div>

    <div class="row">
      <button (click)="olcumEkle()" [disabled]="loading()" [class.btn-update]="duzenlemeModu()">
        @if (loading()) {
        â³ Kaydediliyor...
        } @else if (duzenlemeModu()) {
        âœ… GÃ¼ncelle
        } @else {
        ğŸ’¾ Kaydet
        }
      </button>
      @if (duzenlemeModu()) {
      <button class="btn-cancel" (click)="duzenlemeyiIptalEt()">âŒ Ä°ptal</button>
      } @else {
      <button class="secondary" (click)="formTemizle()">ğŸ—‘ï¸ Temizle</button>
      }
    </div>
  </section>

  <!-- Ã–lÃ§Ã¼m GeÃ§miÅŸi -->
  <section class="card">
    <div class="section-header">
      <h2>ğŸ“‹ Ã–lÃ§Ã¼m GeÃ§miÅŸi</h2>
      <span class="record-count">{{ olcumler().length }} kayÄ±t</span>
    </div>

    @if (olcumler().length > 0) {
    <div class="table-wrapper table-scroll">
      <table>
        <thead>
          <tr>
            <th>Tarih</th>
            <th>Zaman</th>
            <th>BÃ¼yÃ¼k</th>
            <th>KÃ¼Ã§Ã¼k</th>
            <th>Durum</th>
            <th>Ä°ÅŸlemler</th>
          </tr>
        </thead>
        <tbody>
          @for (olcum of olcumler(); track olcum.id) {
          <tr [class.editing-row]="duzenlenenId() === olcum.id">
            <td>{{ formatTarih(olcum.tarih) }}</td>
            <td>
              @if (olcum.zamanDilimi === 'SABAH') {
              ğŸŒ… Sabah
              } @else {
              ğŸŒ™ AkÅŸam
              }
            </td>
            <td class="value">{{ olcum.buyuk }}</td>
            <td class="value">{{ olcum.kucuk }}</td>
            <td>
              @if (olcum.buyuk >= 140 || olcum.kucuk >= 90) {
              <span class="badge badge-yuksek">YÃ¼ksek</span>
              } @else if (olcum.buyuk < 90 || olcum.kucuk < 60) { <span class="badge badge-dusuk">DÃ¼ÅŸÃ¼k</span>
                } @else {
                <span class="badge badge-normal">Normal</span>
                }
            </td>
            <td class="actions">
              <button class="btn-icon btn-edit" (click)="duzenle(olcum)" title="DÃ¼zenle">
                âœï¸
              </button>
              <button class="btn-icon btn-delete" (click)="sil(olcum)" title="Sil">
                ğŸ—‘ï¸
              </button>
            </td>
          </tr>
          }
        </tbody>
      </table>
    </div>
    } @else {
    <p class="empty-text">HenÃ¼z Ã¶lÃ§Ã¼m kaydÄ± bulunmuyor. YukarÄ±daki formu kullanarak yeni Ã¶lÃ§Ã¼m ekleyebilirsiniz.</p>
    }
  </section>

  <section class="card info-card">
    <h2>ğŸ’¡ Tansiyon DeÄŸerleri Rehberi</h2>
    <div class="info-grid">
      <div class="info-item normal">
        <span class="info-emoji">âœ…</span>
        <div>
          <strong>Normal</strong>
          <p>Sistolik: 90-139 mmHg<br>Diyastolik: 60-89 mmHg</p>
        </div>
      </div>
      <div class="info-item yuksek">
        <span class="info-emoji">ğŸ”´</span>
        <div>
          <strong>Hipertansiyon Riski</strong>
          <p>Sistolik: â‰¥140 mmHg<br>Diyastolik: â‰¥90 mmHg</p>
        </div>
      </div>
      <div class="info-item dusuk">
        <span class="info-emoji">ğŸŸ¡</span>
        <div>
          <strong>Hipotansiyon Riski</strong>
          <p>Sistolik: &lt;90 mmHg<br>Diyastolik: &lt;60 mmHg</p>
        </div>
      </div>
    </div>
  </section>

  <footer>
    <p>Bu uygulama tÄ±bbi tavsiye niteliÄŸi taÅŸÄ±maz. LÃ¼tfen doktorunuza danÄ±ÅŸÄ±n.</p>
  </footer>
</div>